<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sharing Page</title>
    <link rel="stylesheet" href="{% static 'css/sharingpage.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
<body>
    <nav class="navbar">
        <div class="navbar-brand">Logged in: Rohith</div>
        <ul class="navbar-links">
            <li><a href="{% url 'dpi-directory' %}">DPI Directory</a></li>
            <li><img src="{% static 'images/user_icon.png' %}" alt="User Icon"></li>
        </ul>
    </nav>

    <div class="container">
        <div class="locker-name">
            <div class="loc">Locker Education</div> 
            <div class="loc">Owner: Rohith</div> 
            <div class="loc">This locker consists of my Education documents</div>  
        </div>
        
        <div class="container-2 clearfix">
            <div class="a">
                <div class="res">Resources</div> 
                <div class="container-3" id="resources-list">
                    <div id="aa">
                        <!-- Existing resources -->
                        <span id="documents"><a href="https://drive.google.com/file/d/1pe4_gNDPW9rEsgqjPrDGO9Ch1DkkkkhD/view?usp=sharing" target="_blank">Transcripts.pdf</a></span>
                        <br><br>
                        <span id="documents"><a href="https://drive.google.com/file/d/119LrNa1_dNeplN6BiBwHqurAU6mn_vQN/view?usp=sharing" target="_blank">10thMarks-card.pdf</a></span>
                    </div>
                    
                    <div id="bb">
                        <div class="public-private">Public/private</div>
                        <div class="public-private">Public/private</div>
                    </div>
                </div>
            <div class="buttons">
                        <button class="button" id="shareBtn">Share</button>
                        &nbsp;&nbsp;&nbsp;
                        <button class="button" id="uploadResourceBtn" data-bs-toggle="modal" data-bs-target="#uploadModal">Upload</button>
            </div>
                
            </div>
            
            <div class="b">
                <h3 id="mycon">My Connections:</h3>
                <div class="conn">
                    <div id="conntent">Btech Admission</div>
                    <div id="conntent">IIITb Transcripts&lt;&gt;Rohith:Education</div>
                    <div id="conntent">Created On: 25/06/24</div>
                    <div id="conntent">Vald Until: 25/08/24</div>
                </div>

                <div class="conn">
                    <div id="conntent">Real Estate</div>
                    <div id="conntent">Mantri Builder Property&lt;&gt;Rohith:Education</div>
                    <div  id="conntent">Created On: 25/06/24</div>
                    <div id="conntent">Vald Until: 25/06/25</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Upload Resource -->
    <div class="modal fade" id="uploadModal" tabindex="-1" aria-labelledby="uploadModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="uploadModalLabel">Upload Resource</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="uploadResourceForm" enctype="multipart/form-data" method="post" action="{% url 'upload_resource' %}">
                        {% csrf_token %}
                        <label for="resourceName">Name of Resource:</label>
                        <input type="text" id="resourceName" name="resource_name" required />
                        <br><br>
                        <label for="fileInput">Choose File:</label>
                        <input type="file" id="fileInput" name="document" required />
                        <br><br>
                        <label for="visibility">Visibility:</label>
                        <select id="visibility" name="type">
                            <option value="private">Private</option>
                            <option value="public">Public</option>
                        </select>
                        <br><br>
                        <input type="hidden" name="locker_id" value="{{ locker.locker_id }}">
                        <input type="hidden" name="owner_id" value="{{ user.user_id }}">
                        <button type="submit" class="btn btn-primary">Upload</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const uploadForm = document.getElementById('uploadResourceForm');

            uploadForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const formData = new FormData(uploadForm);

                fetch(uploadForm.action, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        {#const resourcesList = document.getElementById('resources-list');#}
                        const resourceList = document.getElementById('aa');
                        const visibilityList = document.getElementById('bb');
                        
                        const newDocument = document.createElement('div');
                        newDocument.innerHTML += `<br><span id="documents"><a href="${data.resource_url}" target="_blank">${data.document_name}</a></span>`
                        resourceList.appendChild(newDocument);
                        
                        const visibility = document.createElement('div');
                        visibility.innerHTML += `<span class="public-private">${data.type}</span><br><br>`
                        visibilityList.appendChild(visibility);
                        {#const newResource = `<span id="documents"><a href="${data.resource_url}" target="_blank">${data.document_name}</a></span> <br><br>`#}
                        {#visibilityList.innerHTML += `<span class="public-private">${data.type}</span><br><br>`#}
                        {#const newResource = document.createElement('div');#}
                        
                        {#newResource.innerHTML = `<span id="documents"><a href="${data.resource_url}" target="_blank">${data.document_name}</a></span>#}
                        {#                         <span class="public-private">${data.type}</span><br><br>`;#}
                        
                        // Close the modal after successful upload
                        var modal = new bootstrap.Modal(document.getElementById('uploadModal'));
                        modal.hide();
                    } else {
                        alert(data.error);
                    }
                })
                .catch(error => console.error('Error:', error));
            });
        });
    </script>
</body>
</html>
